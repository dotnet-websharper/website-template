import{f as k,g as h,A as v}from"./main-DwOcRg7A.js";import{r as E,s as L}from"./error-utils-DYgkkwDh.js";import{h as w,c as i}from"./plans-6iVeIsPt.js";const b=`${v}/checkout/session`,C="/website-template/support.html#plans",x="/website-template/manage-subscription.html";let r="pro",s="year";T();async function T(){N();const t=A();r=t.plan,s=t.interval;const e=U();await w(),R(e),H(e,t.seats),O(e),e.country?.addEventListener("change",()=>{l(e,p(e,1))}),F(e)}function U(){return{planName:document.getElementById("wsPlanName"),planPriceLine:document.getElementById("wsPlanPriceLine"),priceHint:document.getElementById("wsPriceHint"),subtotal:document.getElementById("wsSubtotal"),taxes:document.getElementById("wsTaxes"),total:document.getElementById("wsTotal"),seatBlock:document.getElementById("wsSeatSelector"),seatsInput:document.getElementById("wsSeats"),btnMinus:document.getElementById("wsMinus"),btnPlus:document.getElementById("wsPlus"),email:document.getElementById("email"),street:document.getElementById("street"),city:document.getElementById("city"),postal:document.getElementById("postal"),country:document.getElementById("country"),companyCk:document.getElementById("company"),companyBlk:document.getElementById("companyBlock"),companyName:document.getElementById("company-name"),vatin:document.getElementById("vatin"),continueBtn:document.getElementById("wsContinue"),toast:document.getElementById("toast")}}function N(){const t=document.getElementById("backLink");if(!t)return;const e=document.referrer||"";let n=C,a="Plans";try{const c=new URL(e).pathname||"";c.endsWith("/manage-subscription.html")?(n=x,a="Manage subscription"):c.endsWith("/support.html")&&(n=C,a="Plans")}catch{}t.href=n,t.textContent=a,t.addEventListener("click",o=>{!document.referrer&&history.length>1&&(o.preventDefault(),history.back())})}function A(){const t=new URLSearchParams(location.search),e=(t.get("plan")||"pro").toLowerCase(),n=(t.get("interval")||"year").toLowerCase(),a=m(parseInt(t.get("seats")||"1",10)||1);return{plan:e==="freelancer"?"freelancer":"pro",interval:n==="month"?"month":"year",seats:a}}function R(t){const e=i[r],a=(e?.[s]?.unitAmountCents||0)/100,o=!!e?.[s]?.isPerSeat;t.planName&&(t.planName.textContent=e?.name||(r==="pro"?"WebSharper Professional":"Freelancer")),t.planPriceLine&&(o?t.planPriceLine.innerHTML=`${u(a)} <span class="text-base text-gray-600 dark:text-gray-400 font-normal">/ ${I(s)}</span>`:t.planPriceLine.innerHTML=`${u(a)} <span class="text-base text-gray-600 dark:text-gray-400 font-normal">/ ${I(s)}</span>`),t.seatBlock&&t.seatBlock.classList.toggle("hidden",!o),t.priceHint&&(o?t.priceHint.textContent=`Price is ${u(a)} per seat per ${s}.`:t.priceHint.textContent=`Price is ${u(a)} per ${s}.`),l(t,p(t,1))}function H(t,e){!!i[r]?.[s]?.isPerSeat&&t.seatsInput?(d(t,e),t.btnMinus?.addEventListener("click",()=>d(t,(parseInt(t.seatsInput.value||"1",10)|0)-1)),t.btnPlus?.addEventListener("click",()=>d(t,(parseInt(t.seatsInput.value||"1",10)|0)+1)),t.seatsInput.addEventListener("input",()=>d(t,parseInt(t.seatsInput.value||"1",10)))):(t.seatsInput&&(t.seatsInput.value="1"),l(t,1))}function p(t,e){return i[r]?.[s]?.isPerSeat?t.seatsInput?m(parseInt(t.seatsInput.value||"1",10)):e:1}function d(t,e){const n=m(e|0);t.seatsInput&&(t.seatsInput.value=String(n)),l(t,n)}function $(t){const e=P(t.country?.value||""),n=!!t.companyCk?.checked,a=!!(t.vatin?.value||"").trim(),o={AT:.2,BE:.21,BG:.2,HR:.25,CY:.19,CZ:.21,DK:.25,EE:.22,FI:.24,FR:.2,DE:.19,GR:.24,HU:.27,IE:.23,IT:.22,LV:.21,LT:.21,LU:.17,MT:.18,NL:.21,PL:.23,PT:.23,RO:.19,SK:.2,SI:.22,ES:.21,SE:.25},c=e in o;return n?e==="HU"?.27:c&&a?0:c&&!a?o[e]:0:c?o[e]:0}function M(){return(i[r]||FALLBACK[r])?.[s]?.unitAmountCents||0}function l(t,e){const n=!!i[r]?.[s]?.isPerSeat,a=M(),o=n?m(e|0):1,f=(n?o*a:a)/100,S=$(t),g=Math.round(f*S),B=f+g;t.subtotal&&(t.subtotal.textContent=y(f)),t.taxes&&(t.taxes.textContent=y(g)),t.total&&(t.total.textContent=y(B))}function O(t){const e=()=>{const n=!!t.companyCk?.checked;t.companyBlk&&t.companyBlk.classList.toggle("hidden",!n),t.companyName&&(t.companyName.required=n),t.vatin&&(t.vatin.required=n),l(t,p(t,1))};t.companyCk?.addEventListener("change",e),e()}function F(t){t.continueBtn?.addEventListener("click",()=>_(t))}async function _(t){if(!q())return;const e=await V();if(!e)return;const n=D(t),a=t.continueBtn.textContent;W(t.continueBtn,"Processingâ€¦");try{const o=await G(e,n);if(o?.url)window.location.href=o.url;else throw new Error("Unexpected response: missing checkout URL")}catch(o){K(o,t.toast)}finally{j(t.continueBtn,a)}}function q(){const t=document.querySelector("form");return!t||t.reportValidity()}async function V(){let t=h();return t||(await k(!0),t=h()),t||(E(new Error("Please sign in to continue."),{title:"Checkout failed",message:"Please sign in to continue."}),null)}function D(t){return{seats:m(p(t,1)),email:(t.email?.value??"").trim()||draft?.customer?.email||null,interval:s,planCode:r,billingAddress:{line1:(t.street?.value??"").trim(),city:(t.city?.value??"").trim(),postal_code:(t.postal?.value??"").trim(),country:P(t.country?.value||"")},company:t.companyCk?.checked?{name:(t.companyName?.value??"").trim(),vatin:(t.vatin?.value??"").trim()}:null}}function G(t,e){return L(b,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":t},body:JSON.stringify(e)})}function K(t,e){if(t.status===400){const n=t.body&&(t.body.error||t.body.message)||t.message||"Could not start payment (invalid request).";e?(e.textContent=n,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),2500)):(console.error(n),alert(n))}else E(t,{title:"Checkout failed",message:"Something went wrong while starting the payment. Please try again."})}function m(t){return Math.max(1,Math.min(999,t|0))}function u(t){return`$${t.toLocaleString("en-US")}`}function y(t){return`$${t.toLocaleString("en-US")}`}function I(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function P(t){return{hungary:"HU",france:"FR","united-kingdom":"GB"}[(t||"").toLowerCase()]||(t||"").toUpperCase().slice(0,2)}function W(t,e){t&&(t.disabled=!0,t.style.opacity="0.7",t.textContent=e)}function j(t,e){t&&(t.disabled=!1,t.style.opacity="",t.textContent=e)}
