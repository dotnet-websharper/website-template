import{A as C}from"./main-BfJYzbdv.js";import{s as S,r as B}from"./error-utils-DgbAzpRY.js";const T=2500,w=`${C}/checkout/session`,p=t=>`$${t.toLocaleString("en-US")}`,f=t=>Math.max(1,Math.min(999,t|0)),k=t=>({hungary:"HU",france:"FR","united-kingdom":"GB"})[(t||"").toLowerCase()]||(t||"").toUpperCase().slice(0,2),v=new URLSearchParams(location.search),r=f(parseInt(v.get("seats")||"1",10)),d=document.getElementById("wsSubtotal"),u=document.getElementById("wsTaxes"),y=document.getElementById("wsTotal"),h=r*T;d&&(d.textContent=p(h));u&&(u.textContent="$0");y&&(y.textContent=p(h));const b=document.getElementById("email"),x=document.getElementById("street"),L=document.getElementById("city"),P=document.getElementById("postal"),N=document.getElementById("country"),m=document.getElementById("company"),g=document.getElementById("companyBlock"),i=document.getElementById("company-name"),l=document.getElementById("vatin");function E(){const t=!!m?.checked;g&&g.classList.toggle("hidden",!t),i&&(i.required=t),l&&(l.required=t)}m?.addEventListener("change",E);E();const n=document.getElementById("wsContinue");n?.addEventListener("click",async()=>{const t=document.querySelector("form");if(t&&!t.reportValidity())return;const a=JSON.parse(sessionStorage.getItem("wsCheckoutDraft")||"{}"),o={seats:f(Number.isFinite(r)?r:a?.seats??1),email:(b?.value??"").trim()||a?.customer?.email||null,billingAddress:{line1:(x?.value??"").trim(),city:(L?.value??"").trim(),postal_code:(P?.value??"").trim(),country:k(N?.value||"")},company:m?.checked?{name:(i?.value??"").trim(),vatin:(l?.value??"").trim()}:null};try{sessionStorage.setItem("wsCheckoutDraft",JSON.stringify({seats:o.seats,customer:{email:o.email},address:o.billingAddress,company:o.company}))}catch{}const I=n.textContent;n.disabled=!0,n.style.opacity="0.7",n.textContent="Processingâ€¦";try{const e=await S(w,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(e?.url)window.location.href=e.url;else throw new Error("Unexpected response: missing checkout URL")}catch(e){if(e.status===400){const c=e.body&&(e.body.error||e.body.message)||e.message||"Could not start payment (invalid request).",s=document.getElementById("toast");s?(s.textContent=c,s.classList.remove("hidden"),setTimeout(()=>s.classList.add("hidden"),2500)):(console.error(c),alert(c))}else B(e,{endpoint:"/checkout/session",method:"POST",title:"Checkout failed"})}finally{n.disabled=!1,n.style.opacity="",n.textContent=I}});
