function d(n,s={}){const e=a(n,s),t=Math.random().toString(36).slice(2,10);try{sessionStorage.setItem("ws_err_"+t,JSON.stringify(e))}catch{}const o=new URLSearchParams({key:t,status:String(e.status||""),title:e.title||"Error",message:(e.message||"").slice(0,300),endpoint:e.endpoint||"",method:e.method||"",rid:e.requestId||"",ts:String(Date.now()),page:location.href});location.href=`./error.html?${o.toString()}`}async function u(n,s){const e=await fetch(n,s);let t=null;if((e.headers.get("content-type")||"").includes("application/json"))try{t=await e.json()}catch{}else t=await e.text();if(!e.ok||t&&typeof t=="object"&&"error"in t){const r=new Error(t&&t.error||e.statusText||"Request failed");throw r.status=e.status||void 0,r.response=e,r.body=t,r}return t}function a(n,s){const e=n?.response,t=e?.headers?.get?.("x-request-id")||e?.headers?.get?.("request-id")||s.requestId;return{status:n?.status??e?.status??s.status,title:s.title||"Request error",message:n?.message||s.message,endpoint:s.endpoint,method:s.method,requestId:t,when:new Date().toISOString(),page:s.page||location.href,userAgent:navigator.userAgent,extra:{body:n?.body??void 0}}}export{d as r,u as s};
