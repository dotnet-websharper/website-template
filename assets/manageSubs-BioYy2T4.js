import"./main-KxWlwpta.js";/* empty css              */document.addEventListener("DOMContentLoaded",()=>{const m=new URLSearchParams(location.search).get("sub")||"demo-sub-1";localStorage.getItem("if_api_token");const a=t=>document.getElementById(t),d=a("seatsBody"),w=a("applyBulk"),L=a("clearBulk"),x=a("refresh"),v=a("saveAll"),o=a("accountSelect");if(!d||!w||!L||!x||!v)return;let i=null,g=[],f=[],c=null,l=new Map;const b=t=>{if(typeof t!="string")return!1;const e=t.trim();return!(!e||!/^[A-Za-z0-9-]{1,39}$/.test(e)||e.startsWith("-")||e.endsWith("-")||e.includes("--"))},S=t=>t&&typeof t=="string"?t.trim().toLowerCase():null;function T(t,e){const n=e>0?Math.round(t/e*100):0;a("seatProgress").style.width=n+"%";const s=Math.max(e-t,0);a("seatsBadge").textContent=`${t} assigned, ${s} available`}function h(t){const e=a("toast");if(!e)return alert(t);e.textContent=t,e.classList.remove("hidden"),setTimeout(()=>e.classList.add("hidden"),1600)}function p(t){const e=a("spinner");e&&e.classList.toggle("hidden",!t)}function u(){const t=l.size>0,e=!!(c&&i&&c!==i.account_name);v.disabled=!(t||e)}window.addEventListener("beforeunload",t=>{const e=l.size>0,n=!!(c&&i&&c!==i.account_name);(e||n)&&t.preventDefault()});async function $(t){return new Promise(e=>setTimeout(()=>e({id:t,plan:"Professional",seats_total:5,seats_used:2,renews_at:"2026-01-01",status:"active",account_name:"acme-inc"}),200))}async function k(t){return new Promise(e=>setTimeout(()=>e([{seat_id:"s1",github_login:"alice",status:"assigned",assigned_at:"2025-01-01"},{seat_id:"s2",github_login:"bob-dev",status:"assigned",assigned_at:"2025-01-03"},{seat_id:"s3",github_login:null,status:"unassigned"},{seat_id:"s4",github_login:null,status:"unassigned"},{seat_id:"s5",github_login:null,status:"unassigned"}]),200))}async function C(){return new Promise(t=>setTimeout(()=>t([{id:"acme-inc",display:"acme-inc"},{id:"personal",display:"personal"},{id:"lab-42",display:"lab-42"}]),150))}async function P(t,e){return new Promise(n=>setTimeout(()=>n({ok:!0,seats:e}),250))}async function A(t,e){return new Promise(n=>setTimeout(()=>n({ok:!0,account_name:e}),200))}function D(t){if(!t)return"-";try{return new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"2-digit"})}catch{return t}}function E(){if(!o)return;if(o.innerHTML="",!f.length){const e=document.createElement("option");e.value=i?.account_name||"",e.textContent=i?.account_name||"No accounts",o.appendChild(e),o.disabled=!0;return}f.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.display||e.id,o.appendChild(n)}),o.disabled=!1;const t=i?.account_name;t&&f.some(e=>e.id===t)?o.value=t:o.value=f[0].id}function y(){a("planName").textContent=i.plan,a("seatsTotal").textContent=i.seats_total;const t=g.filter(e=>!!e.github_login).length;if(a("seatsUsed").textContent=t,a("renewsAt").textContent=D(i.renews_at),a("subStatus").textContent=i.status,o&&o.options.length>0){const e=i.account_name||"";[...o.options].some(n=>n.value===e)&&(o.value=e)}T(t,i.seats_total)}function M(t,e){const n=`seat-${t.seat_id}`,s=t.github_login??"",r=t.github_login?"assigned":"unassigned";return`
    <tr data-seat-row="${t.seat_id}">
      <td class="px-4 py-3">#${e+1}</td>
      <td class="px-4 py-2">
        <div class="flex items-center gap-2">
          <label class="sr-only" for="${n}">GitHub username for seat #${e+1}</label>
          <span class="text-gray-400">@</span>
          <input id="${n}" data-seat="${t.seat_id}" value="${s}" placeholder="unassigned"
                 class="w-full rounded-md border border-gray-300 dark:border-gray-800 bg-transparent px-2 py-1"/>
        </div>
        <p class="mt-1 hidden text-xs text-red-600" id="err-${t.seat_id}">Invalid GitHub username</p>
      </td>
      <td class="px-4 py-3 capitalize">${r}</td>
      <td class="px-4 py-2 text-right">
        <button data-action="unassign" data-seat="${t.seat_id}"
                class="text-sm underline text-gray-600 dark:text-gray-300 ${t.github_login?"":"opacity-30 pointer-events-none"}">
          Unassign
        </button>
      </td>
    </tr>`}function _(){d.innerHTML=g.map(M).join("")}function q(){d.addEventListener("input",t=>{if(!t.target.matches("input[data-seat]"))return;const e=t.target.dataset.seat,n=S(t.target.value),s=a(`err-${e}`);n&&!b(n)?(t.target.classList.add("ring-1","ring-red-500"),s?.classList.remove("hidden")):(t.target.classList.remove("ring-1","ring-red-500"),s?.classList.add("hidden")),l.set(e,n||null),u()}),d.addEventListener("click",t=>{if(!t.target.matches('button[data-action="unassign"]'))return;const e=t.target.dataset.seat,n=d.querySelector(`input[data-seat="${e}"]`);n.value="",n.classList.remove("ring-1","ring-red-500"),a(`err-${e}`)?.classList.add("hidden"),l.set(e,null),u()})}o&&o.addEventListener("change",()=>{c=o.value||null,u()}),w.addEventListener("click",()=>{const t=a("bulkBox").value.trim();if(!t)return;const e=t.split(/[\s,]+/).map(r=>S(r)).filter(Boolean);if(e.filter(r=>!b(r)).length){a("bulkError").classList.remove("hidden");return}a("bulkError").classList.add("hidden");const s=g.filter(r=>!r.github_login);for(let r=0;r<s.length&&r<e.length;r++){const B=s[r].seat_id,z=d.querySelector(`input[data-seat="${B}"]`);z.value=e[r],l.set(B,e[r])}u()}),L.addEventListener("click",()=>{a("bulkBox").value="",a("bulkError").classList.add("hidden")}),x.addEventListener("click",async()=>{p(!0),l.clear(),c=null,i=await $(m),f=await C(),E(),g=await k(),y(),_(),u(),p(!1)}),v.addEventListener("click",async()=>{const t=Array.from(l.entries()).map(([n,s])=>({seat_id:n,github_login:s,action:s?"assign":"unassign"})),e=!!(c&&i&&c!==i.account_name);if(!t.length&&!e)return h("Nothing to save");for(const[n,s]of l.entries())if(s&&!b(s)){d.querySelector(`input[data-seat="${n}"]`)?.classList.add("ring-1","ring-red-500"),a(`err-${n}`)?.classList.remove("hidden"),h("Fix invalid usernames");return}p(!0);try{e&&(await A(m,c),i.account_name=c,c=null),t.length&&(await P(m,t),t.forEach(n=>{const s=g.find(r=>r.seat_id===n.seat_id);s.github_login=n.github_login}),l.clear(),_(),t.forEach(n=>{const s=d.querySelector(`[data-seat-row="${n.seat_id}"]`);s?.classList.add("bg-yellow-50","dark:bg-yellow-900/20"),setTimeout(()=>s?.classList.remove("bg-yellow-50","dark:bg-yellow-900/20"),800)})),y(),u(),h("Saved")}catch(n){console.error(n),h("Save failed")}finally{p(!1)}}),(async function(){p(!0),i=await $(m),f=await C(),E(),g=await k(),y(),_(),q(),u(),p(!1)})()});
