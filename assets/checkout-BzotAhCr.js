import{f as k,g,A as B}from"./main-DyUGKaRG.js";import{r as S,s as v}from"./error-utils-DYgkkwDh.js";const i={pro:{month:{amount:250,perSeat:!0},year:{amount:2500,perSeat:!0}},freelancer:{month:{amount:30,perSeat:!1},year:{amount:300,perSeat:!1}}},L=`${B}/checkout/session`,h="/website-template/support.html#plans",w="/website-template/manage-subscription.html";let c="pro",o="year";b();function b(){T();const e=U();c=e.plan,o=e.interval;const t=x();N(t),R(t,e.seats),$(t),t.country?.addEventListener("change",()=>{d(t,f(t,1))}),M(t)}function x(){return{planName:document.getElementById("wsPlanName"),planPriceLine:document.getElementById("wsPlanPriceLine"),priceHint:document.getElementById("wsPriceHint"),subtotal:document.getElementById("wsSubtotal"),taxes:document.getElementById("wsTaxes"),total:document.getElementById("wsTotal"),seatBlock:document.getElementById("wsSeatSelector"),seatsInput:document.getElementById("wsSeats"),btnMinus:document.getElementById("wsMinus"),btnPlus:document.getElementById("wsPlus"),email:document.getElementById("email"),street:document.getElementById("street"),city:document.getElementById("city"),postal:document.getElementById("postal"),country:document.getElementById("country"),companyCk:document.getElementById("company"),companyBlk:document.getElementById("companyBlock"),companyName:document.getElementById("company-name"),vatin:document.getElementById("vatin"),continueBtn:document.getElementById("wsContinue"),toast:document.getElementById("toast")}}function T(){const e=document.getElementById("backLink");if(!e)return;const t=document.referrer||"";let n=h,a="Plans";try{const r=new URL(t).pathname||"";r.endsWith("/manage-subscription.html")?(n=w,a="Manage subscription"):r.endsWith("/support.html")&&(n=h,a="Plans")}catch{}e.href=n,e.textContent=a,e.addEventListener("click",s=>{!document.referrer&&history.length>1&&(s.preventDefault(),history.back())})}function U(){const e=new URLSearchParams(location.search),t=(e.get("plan")||"pro").toLowerCase(),n=(e.get("interval")||"year").toLowerCase(),a=l(parseInt(e.get("seats")||"1",10)||1);return{plan:t==="freelancer"?"freelancer":"pro",interval:n==="month"?"month":"year",seats:a}}function N(e){const t=c==="pro",n=i[c][o];e.planName&&(e.planName.textContent=t?"WebSharper Professional":"Freelancer"),e.planPriceLine&&(n.perSeat?e.planPriceLine.innerHTML=`${u(n.amount)} <span class="text-base text-gray-600 dark:text-gray-400 font-normal">/ ${I(o)}</span>`:e.planPriceLine.innerHTML=`${u(n.amount)} <span class="text-base text-gray-600 dark:text-gray-400 font-normal">/ ${I(o)}</span>`),e.seatBlock&&e.seatBlock.classList.toggle("hidden",!n.perSeat),e.priceHint&&(n.perSeat?e.priceHint.textContent=`Price is ${u(n.amount)} per seat per ${o}.`:e.priceHint.textContent=`Price is ${u(n.amount)} per ${o}.`)}function R(e,t){i[c][o].perSeat&&e.seatsInput?(m(e,t),e.btnMinus?.addEventListener("click",()=>m(e,(parseInt(e.seatsInput.value||"1",10)|0)-1)),e.btnPlus?.addEventListener("click",()=>m(e,(parseInt(e.seatsInput.value||"1",10)|0)+1)),e.seatsInput.addEventListener("input",()=>m(e,parseInt(e.seatsInput.value||"1",10)))):(e.seatsInput&&(e.seatsInput.value="1"),d(e,1))}function f(e,t){return i[c][o].perSeat?e.seatsInput?l(parseInt(e.seatsInput.value||"1",10)):t:1}function m(e,t){const n=l(t|0);e.seatsInput&&(e.seatsInput.value=String(n)),d(e,n)}function H(e){const t=C(e.country?.value||""),n=!!e.companyCk?.checked,a=!!(e.vatin?.value||"").trim(),s={AT:.2,BE:.21,BG:.2,HR:.25,CY:.19,CZ:.21,DK:.25,EE:.22,FI:.24,FR:.2,DE:.19,GR:.24,HU:.27,IE:.23,IT:.22,LV:.21,LT:.21,LU:.17,MT:.18,NL:.21,PL:.23,PT:.23,RO:.19,SK:.2,SI:.22,ES:.21,SE:.25},r=t in s;return n?t==="HU"?.27:r&&a?0:r&&!a?s[t]:0:r?s[t]:0}function d(e,t){const n=i[c][o],a=n.perSeat,s=a?l(t|0):1,r=a?s*n.amount:n.amount,E=H(e),y=Math.round(r*E),P=r+y;e.subtotal&&(e.subtotal.textContent=p(r)),e.taxes&&(e.taxes.textContent=p(y)),e.total&&(e.total.textContent=p(P))}function $(e){const t=()=>{const n=!!e.companyCk?.checked;e.companyBlk&&e.companyBlk.classList.toggle("hidden",!n),e.companyName&&(e.companyName.required=n),e.vatin&&(e.vatin.required=n),d(e,f(e,1))};e.companyCk?.addEventListener("change",t),t()}function M(e){e.continueBtn?.addEventListener("click",()=>A(e))}async function A(e){if(!O())return;const t=await D();if(!t)return;const n=_(e);G(n);const a=e.continueBtn.textContent;J(e.continueBtn,"Processingâ€¦");try{const s=await F(t,n);if(s?.url)window.location.href=s.url;else throw new Error("Unexpected response: missing checkout URL")}catch(s){q(s,e.toast)}finally{K(e.continueBtn,a)}}function O(){const e=document.querySelector("form");return!e||e.reportValidity()}async function D(){let e=g();return e||(await k(!0),e=g()),e||(S(new Error("Please sign in to continue."),{title:"Checkout failed",message:"Please sign in to continue."}),null)}function _(e){const t=V();return{seats:i[c][o].perSeat?l(f(e,1)||t?.seats||1):1,email:(e.email?.value??"").trim()||t?.customer?.email||null,interval:o,plan:c,billingAddress:{line1:(e.street?.value??"").trim(),city:(e.city?.value??"").trim(),postal_code:(e.postal?.value??"").trim(),country:C(e.country?.value||"")},company:e.companyCk?.checked?{name:(e.companyName?.value??"").trim(),vatin:(e.vatin?.value??"").trim()}:null}}function F(e,t){return v(L,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":e},body:JSON.stringify(t)})}function q(e,t){if(e.status===400){const n=e.body&&(e.body.error||e.body.message)||e.message||"Could not start payment (invalid request).";t?(t.textContent=n,t.classList.remove("hidden"),setTimeout(()=>t.classList.add("hidden"),2500)):(console.error(n),alert(n))}else S(e,{title:"Checkout failed",message:"Something went wrong while starting the payment. Please try again."})}function V(){try{return JSON.parse(sessionStorage.getItem("wsCheckoutDraft")||"{}")}catch{return{}}}function G(e){try{sessionStorage.setItem("wsCheckoutDraft",JSON.stringify({seats:e.seats,customer:{email:e.email},address:e.billingAddress,company:e.company}))}catch{}}function l(e){return Math.max(1,Math.min(999,e|0))}function u(e){return`$${e.toLocaleString("en-US")}`}function p(e){return`$${e.toLocaleString("en-US")}`}function I(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function C(e){return{hungary:"HU",france:"FR","united-kingdom":"GB"}[(e||"").toLowerCase()]||(e||"").toUpperCase().slice(0,2)}function J(e,t){e&&(e.disabled=!0,e.style.opacity="0.7",e.textContent=t)}function K(e,t){e&&(e.disabled=!1,e.style.opacity="",e.textContent=t)}
