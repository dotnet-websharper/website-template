<!doctype html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body class="bg-white dark:bg-gray-950 text-gray-900 dark:text-gray-100">
  <main class="mx-auto max-w-3xl p-6">
    <div class="mb-6 flex items-center justify-between">
      <h1 class="text-xl font-bold">Invoice <span id="invId"></span></h1>
      <a href="./manage-subscription.html#subs"
         class="rounded-md border px-3 py-2 text-sm border-gray-300 dark:border-white/20">Back</a>
    </div>

    <section class="rounded-xl border border-gray-200 p-5 dark:border-gray-800 space-y-3">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Date</div>
          <div id="invDate" class="font-medium">-</div>
        </div>
        <div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Status</div>
          <div id="invStatus" class="font-medium capitalize">-</div>
        </div>
        <div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Amount</div>
          <div id="invAmount" class="font-medium">-</div>
        </div>
        <div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Subscription</div>
          <div id="invSub" class="font-medium">-</div>
        </div>
      </div>
      <hr class="border-gray-200 dark:border-white/10" />
      <div id="billTo" class="text-sm">
        <div class="text-gray-600 dark:text-gray-400">Bill to</div>
        <div id="billToName">-</div>
        <div id="billToAddr" class="text-gray-600 dark:text-gray-400">-</div>
        <div id="billToVat" class="text-gray-600 dark:text-gray-400">-</div>
      </div>
      <!-- Add line items if you expose them -->
      <div id="lineItems" class="mt-4"></div>
    </section>
  </main>

  <script type="module">
    const API_BASE = (window.__WS_API_BASE__) || "https://api.ws.com";
    const qs = new URLSearchParams(location.search);
    const id = qs.get("id");
    const sub = qs.get("sub");
    const $ = (id) => document.getElementById(id);

    function money(cents, ccy="USD") {
      return (Number(cents||0)/100).toLocaleString(undefined, { style: "currency", currency: ccy.toUpperCase() });
    }

    // TODO: replace with real API: GET /subscriptions/:sub/invoices/:id
    async function loadInvoice() {
      // mock
      return { id, date: "2025-07-12", amount: 250000, currency: "usd", status: "paid",
               billing: { name: "ACME Inc.", vatin: "EU123", line1: "Main St 1", city: "Budapest", postal_code: "1011", country: "HU" } };
    }

    (async function init(){
      const inv = await loadInvoice();
      $("invId").textContent = inv.id;
      $("invDate").textContent = inv.date;
      $("invStatus").textContent = inv.status;
      $("invAmount").textContent = money(inv.amount, inv.currency);
      $("invSub").textContent = sub || "-";

      $("billToName").textContent = inv.billing?.name || "-";
      $("billToVat").textContent = inv.billing?.vatin ? `VAT: ${inv.billing.vatin}` : "";
      $("billToAddr").textContent = [inv.billing?.line1, inv.billing?.postal_code, inv.billing?.city, inv.billing?.country]
        .filter(Boolean).join(", ");
    })();
  </script>
</body>
</html>
